private class ButtonListener implements ActionListener
    {
        @Override
        public void actionPerformed(ActionEvent ae) {
            Object source = ae.getSource();
            //===========btnScan=======================
            if(source == btnScan){
                try{
                    // Show the list of available terminals
                    // On Windows see HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Cryptography\Calais\Readers
                    TerminalFactory factory = TerminalFactory.getDefault();
                    List terminals = factory.terminals().list();
                    System.out.println("Terminals count: " + terminals.size());
                    System.out.println("Terminals: " + terminals);
                    lblScan.setText("Terminals: " + terminals);

                    // Get the first terminal in the list
                    CardTerminal terminal = (CardTerminal) terminals.get(0);

                    // Establish a connection with the card using
                    // "T=0", "T=1", "T=CL" or "*"
                    Card card = terminal.connect("*");
                    System.out.println("Card: " + card);

                    // Get ATR
                    byte[] baATR;
                    //System.out.println("ATR: " + Main.toString(baATR) );
                    baATR = card.getATR().getBytes();

                    // Select Card Manager
                    // - Establish channel to exchange APDU
                    // - Send SELECT Command APDU
                    // - Show Response APDU
                    CardChannel channel = card.getBasicChannel();

                    //SELECT Command
                    // See GlobalPlatform Card Specification (e.g. 2.2, section 11.9)
                    // CLA: 00
                    // INS: A4
                    // P1: 04 i.e. b3 is set to 1, means select by name
                    // P2: 00 i.e. first or only occurence
                    // Lc: 08 i.e. length of AID see below
                    // Data: A0 00 00 00 03 00 00 00
                    // AID of the card manager,
                    // in the future should change to A0 00 00 01 51 00 00

                    byte[] baCommandAPDU = {
                        (byte) 0x00, (byte) 0xA4, (byte) 0x04,
                        (byte) 0x00, (byte) 0x08, (byte) 0xA0,
                        (byte) 0x00, (byte) 0x00, (byte) 0x00,
                        (byte) 0x54, (byte) 0x48, (byte) 0x00,
                        (byte) 0x01
                    };
                    //System.out.println("APDU <<<: " + Main.toString(baCommandAPDU));
                    ResponseAPDU r = channel.transmit(new CommandAPDU(baCommandAPDU));
                    //System.out.println("APDU >>>: " + Main.toString(r.getBytes()));
                    //===========CID===================================
                    byte[] command_idcard = {
                        (byte) 0x80, (byte) 0xb0, (byte) 0x00,
                        (byte) 0x04, (byte) 0x02, (byte) 0x00,
                        (byte) 0x0d
                    };
                
                    ResponseAPDU response_command_idcard2 = channel.transmit(new CommandAPDU(command_idcard));
                    txtIDCard.setText(new String(response_command_idcard2.getBytes(), "TIS620").substring(0,13));
                    //System.out.println(new String(response_command_idcard2.getBytes(), "TIS620").substring(0,13));
                    
                    //=========Gender===================================
                    //0x80, 0xb0, 0x00, 0xE1, 0x02, 0x00, 0x01
                    byte[] command_gender = {
                        (byte) 0x80, (byte) 0xb0, (byte) 0x00,
                        (byte) 0xE1, (byte) 0x02, (byte) 0x00,
                        (byte) 0x01
                    };
                    
                    ResponseAPDU response_command_gender = channel.transmit(new CommandAPDU(command_gender));
                    if(new String(response_command_gender.getBytes(), "TIS620").substring(0,1).equals("1")){
                        cmbSexFK.setSelectedItem("ชาย");
                    }else{                            
                        cmbSexFK.setSelectedItem("หญิง");
                    }
                    
                    //=========Th Fullname==============================
                    byte[] command_thfullname = {
                        (byte) 0x80, (byte) 0xb0, (byte) 0x00,
                        (byte) 0x11, (byte) 0x02, (byte) 0x00,
                        (byte) 0x64
                    };
                
                    ResponseAPDU response_command_thfullname = channel.transmit(new CommandAPDU(command_thfullname));
                    //System.out.println(new String(response_command_thfullname.getBytes(), "TIS620").substring(0, 60));
                
                    String[] parts = new String(response_command_thfullname.getBytes(), "TIS620").substring(0, 35).split("#");//102
                    String part1 = parts[0]; // คำนำหน้า
                    String part2 = parts[1]; // ชื่อ
                    //String part3 = parts[2]; // ว่าง
                    String part3 = parts[3].replaceFirst(" ", ""); // สกุล
                                   //parts[3].substring(0,20).replaceFirst(" ", "")   
                    cmbTitleFK.setSelectedItem(String.valueOf(part1)); // คำนำหน้า
                    txtFirstName.setText(part2); // ชื่อ                    
                    txtLastName.setText(part3); // สกุล
                    //System.out.println(part1);
                    //System.out.println(part2);
                    //System.out.println(part4);
                    
                    //=========Address======================
                    byte[] command_address = {
                        (byte) 0x80, (byte) 0xb0, (byte) 0x15,
                        (byte) 0x79, (byte) 0x02, (byte) 0x00,
                        (byte) 0x64
                    };
   
                    ResponseAPDU answer6 = channel.transmit(new CommandAPDU(command_address));
                    //System.out.println(new String(answer6.getBytes(), "TIS620").substring(0,60));
                
                    String[] enpart11 = new String(answer6.getBytes(), "TIS620").substring(0, 60).split("#");
                    String enpart12 = enpart11[0]; // บ้านเลขที่
                    String enpart13 = enpart11[1]; // หมู่ที่
                    //String enpart14 = enpart11[2];// Land
                    //String enpart15 = enpart11[3]; // Road
                    //String enpart16 = enpart11[4];
                    String enpart17 = enpart11[5]; // ตำบล
                    String enpart18 = enpart11[6]; // อำเภอ
                    String enpart19 = enpart11[7]; // จังหวัด
                
                    //System.out.println(enpart12);
                    //System.out.println(enpart13);
                    int str17 = enpart17.length();
                    System.out.println(enpart17.substring(4, str17));//ตำบล
                    int str18 = enpart18.length();
                    System.out.println(enpart18.substring(5, str18));//อำเภอ
                    int str19 = enpart19.length();
                    System.out.println(enpart19.substring(7, str19));//จังหวัด
                    //===========================
                    String str2 = String.format("%3s", enpart12).replace(' ', '0'); // บ้านเลขที่
                    txtBanID.setText(str2);
                    //System.out.println(str2);
                    String moo = enpart11[1].substring(7,9).replaceFirst(" ", "");// ลบค่าว่างทิ้ง
                    //enpart11[1].substring(7,9); // หมู่ที่
                    String moo2 = String.format("%2s", moo).replace(' ', '0');//เติม 0 หน้า
                    txtMoo.setText(moo2);
                    //System.out.println(moo);
                    
                    //=========Date of birth=======================
                    byte[] command_dateofbirth = {
                        (byte) 0x80, (byte) 0xb0, (byte) 0x00,
                        (byte) 0xd9, (byte) 0x02, (byte) 0x00,
                        (byte) 0x08
                    };            
                
                    ResponseAPDU answer1 = channel.transmit(new CommandAPDU(command_dateofbirth));
                    //System.out.println(new String(answer1.getBytes(), "TIS620").substring(0,8));
                
                    String year=new String(answer1.getBytes(), "TIS620").substring(0,4);
                    int foo = Integer.parseInt(year);
                    int foo2 = foo-543;
                    String month=new String(answer1.getBytes(), "TIS620").substring(4,6);
                    String day=new String(answer1.getBytes(), "TIS620").substring(6,8);
                    
                    txtBirthDate.setDate(java.sql.Date.valueOf(foo2+"-"+month+"-"+day));
                    //txtBirthday.setText(day+"/"+month+"/"+year);
                    
                    //System.out.println(day+"/"+month+"/"+year);
                    //System.out.println(foo2+"-"+month+"-"+day);
                    
                    //=========คำนวณอายุ=====================
                    //Date dtx1 = new Date();
                    Calendar cal = Calendar.getInstance();
                    Date today = cal.getTime();
                    cal.add(Calendar.YEAR, -1); // to get previous year add -1
                    Date nextYear = cal.getTime();
                
                
                    SimpleDateFormat formatter = new SimpleDateFormat("yyyy-MM-dd");
                    String StrBirthdate = foo2+"-"+month+"-"+day;
                
                    String thisYear1 = new SimpleDateFormat("yyyy").format(new Date()); //ปีปัจจุบัน
                    String thisYear2 = new SimpleDateFormat("yyyy").format(nextYear); //